<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.3">
<title>Interactive Cohort Explorer | OHDSI-Stroke</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.dcdbf18e.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,200..900;1,8..60,200..900&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.dcdbf18e.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.ea9fd553.css">
<link rel="modulepreload" href="./_observablehq/client.33da7c34.js">
<link rel="modulepreload" href="./_observablehq/runtime.e080113b.js">
<link rel="modulepreload" href="./_observablehq/stdlib.73a8ec5a.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.4ef1d259.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.17/d761ef9b.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/9cffc2bd.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/72f4716c.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/18cbf477.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/e780feca.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/53fe8176.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/e93ca09f.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/0f2de24d.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/65eb105b.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/7ef8fb2e.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/aeb57b94.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/1d2aed74.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/5ced1d52.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/9ba9c7f3.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/4202580c.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/cdd7e898.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/b4e2ad9a.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/5e804d15.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/86074ef6.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/40599fb3.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/e49e792c.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/8d1e5425.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/20d3f133.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/7553081f.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/0dfd751c.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/3c90ee06.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/843b6a76.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/ba24c2e7.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/4d94e5b7.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/6d3a6726.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/9f03c579.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/07c9626f.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/b58a267d.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/004da2ac.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/b5786b3f.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/cbf6ba23.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/e08981d9.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/02d43215.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/aa00730b.js">
<link rel="icon" href="./_file/observable.1af93621.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.33da7c34.js";
import {registerFile} from "./_observablehq/stdlib.73a8ec5a.js";

registerFile("./high_risk_cohort_no_dementia.csv", {"name":"./high_risk_cohort_no_dementia.csv","mimeType":"text/csv","path":"./_file/high_risk_cohort_no_dementia.7704ca6b.csv","lastModified":1764814820851,"size":7178755});

define({id: "1d803bd4", inputs: ["FileAttachment"], outputs: ["data"], body: async (FileAttachment) => {
const data = await FileAttachment("./high_risk_cohort_no_dementia.csv").csv({typed: true});
return {data};
}});

define({id: "4ce638d1", inputs: ["data"], outputs: ["totalPatients","withAphasia","withoutAphasia"], body: (data) => {
const totalPatients = data.length;
const withAphasia = data.filter(d => d.has_aphasia === 1).length;
const withoutAphasia = data.filter(d => d.has_aphasia === 0).length;
return {totalPatients,withAphasia,withoutAphasia};
}});

define({id: "8edf6297", mode: "inline", inputs: ["totalPatients","display"], body: async (totalPatients,display) => {
display(await(
totalPatients.toLocaleString()
))
}});

define({id: "b67d9ad2", mode: "inline", inputs: ["withAphasia","display"], body: async (withAphasia,display) => {
display(await(
withAphasia.toLocaleString()
))
}});

define({id: "1fa81da3", mode: "inline", inputs: ["withoutAphasia","display"], body: async (withoutAphasia,display) => {
display(await(
withoutAphasia.toLocaleString()
))
}});

define({id: "86c65c59", outputs: ["getFilteredData","conditions"], body: () => {
// filter and aphasia prevalence
function getFilteredData(data, selectedConditions) {
  let filtered = data;
  
  // AND logic
  if (selectedConditions.length > 0) {
    filtered = data.filter(d => 
      selectedConditions.every(cond => d[cond] === 1)
    );
  }
  
  const withAphasia = filtered.filter(d => d.has_aphasia === 1).length;
  const withoutAphasia = filtered.filter(d => d.has_aphasia === 0).length;
  const total = filtered.length;
  
  // within-group prevalence
  const totalWithAphasia = data.filter(d => d.has_aphasia === 1).length;
  const totalWithoutAphasia = data.filter(d => d.has_aphasia === 0).length;
  
  return [
    {
      group: 'With Aphasia',
      count: withAphasia,
      total: total,
      prevalence: total > 0 ? (withAphasia / total) * 100 : 0,
      withinGroupPrevalence: totalWithAphasia > 0 ? (withAphasia / totalWithAphasia) * 100 : 0,
      groupTotal: totalWithAphasia
    },
    {
      group: 'Without Aphasia',
      count: withoutAphasia,
      total: total,
      prevalence: total > 0 ? (withoutAphasia / total) * 100 : 0,
      withinGroupPrevalence: totalWithoutAphasia > 0 ? (withoutAphasia / totalWithoutAphasia) * 100 : 0,
      groupTotal: totalWithoutAphasia
    }
  ];
}

const conditions = [
  {value: 'has_depression', label: 'Depression'},
  {value: 'has_anxiety', label: 'Anxiety'},
  {value: 'has_bipolar', label: 'Bipolar'},
  {value: 'has_schizophrenia', label: 'Schizophrenia'},
  {value: 'has_ptsd', label: 'PTSD'},
  {value: 'has_psychotic_disorder', label: 'Psychotic Disorder'},
  {value: 'has_seizure', label: 'Seizure'},
  {value: 'has_polypharmacy', label: 'Polypharmacy (PIMs)'},
  {value: 'has_polypharmacy_all_meds', label: 'Polypharmacy (All Meds)'},
  {value: 'has_any_mental_health_condition', label: 'Any Mental Health Condition'},
  {value: 'has_antidepressant', label: 'Antidepressant'},
  {value: 'has_antipsychotic', label: 'Antipsychotic'},
  {value: 'has_anxiolytic', label: 'Anxiolytic'},
  {value: 'has_hypnotic_sedative', label: 'Hypnotic/Sedative'},
  {value: 'is_high_risk', label: 'High Risk'},
  {value: 'antidep_risk', label: 'Antidepressant Risk'},
  {value: 'anxiolytic_risk', label: 'Anxiolytic Risk'},
  {value: 'hyp_sed_risk', label: 'Hypnotic/Sedative Risk'},
  {value: 'antipsych_risk', label: 'Antipsychotic Risk'}
];

return {getFilteredData,conditions};
}});

define({id: "9a93ab0d", inputs: ["Inputs","conditions","Generators","view"], outputs: ["conditionInput","selectedConditionLabels"], body: (Inputs,conditions,Generators,view) => {
const conditionInput = Inputs.checkbox(
  conditions.map(c => c.label),
  {label: "Filter by Conditions", value: []}
);
const selectedConditionLabels = Generators.input(conditionInput);
view(conditionInput);
return {conditionInput,selectedConditionLabels};
}});

define({id: "be7a6c50", inputs: ["Inputs","Generators","view"], outputs: ["viewModeInput","currentViewMode"], body: (Inputs,Generators,view) => {
const viewModeInput = Inputs.radio(
  ["Counts", "Population Prevalence %", "Within-Group Prevalence %"],
  {label: "Display Mode", value: "Counts"}
);
const currentViewMode = Generators.input(viewModeInput);
view(viewModeInput);
return {viewModeInput,currentViewMode};
}});

define({id: "098973fe", inputs: ["selectedConditionLabels","conditions","getFilteredData","data"], outputs: ["selectedConditions","chartData","totalFiltered"], body: (selectedConditionLabels,conditions,getFilteredData,data) => {
const selectedConditions = selectedConditionLabels.map(label => 
  conditions.find(c => c.label === label).value
);

const chartData = getFilteredData(data, selectedConditions);
const totalFiltered = chartData[0].total;
return {selectedConditions,chartData,totalFiltered};
}});

define({id: "19b75ab1", mode: "inline", inputs: ["totalFiltered","display"], body: async (totalFiltered,display) => {
display(await(
totalFiltered.toLocaleString()
))
}});

define({id: "0b0ebcb5", mode: "inline", inputs: ["selectedConditions","selectedConditionLabels","display"], body: async (selectedConditions,selectedConditionLabels,display) => {
display(await(
selectedConditions.length > 0 ? ` ${selectedConditionLabels.join(' AND ')}` : 'Showing all patients'
))
}});

define({id: "82ec1f34", inputs: ["Plot","currentViewMode","chartData","display"], body: async (Plot,currentViewMode,chartData,display) => {
display(await(
Plot.plot({
  width: 600,
  height: 400,
  marginBottom: 60,
  x: {
    label: null
  },
  y: {
    label: currentViewMode === "Counts" ? "Number of Patients" : 
           currentViewMode === "Population Prevalence %" ? "Prevalence (% of filtered cohort)" :
           "Prevalence (% of aphasia/non-aphasia group)",
    grid: true,
    domain: currentViewMode === "Counts" ? [0, Math.max(...chartData.map(d => d.count)) * 1.1] : [0, 100]
  },
  color: {
    domain: ['With Aphasia', 'Without Aphasia'],
    range: ['#ff7f0e', '#1f77b4'] // should be tab:blue and tab:orange, my usual defaults :p
  },
  marks: [
    Plot.barY(chartData, {
      x: "group",
      y: currentViewMode === "Counts" ? "count" : 
         currentViewMode === "Population Prevalence %" ? "prevalence" : "withinGroupPrevalence",
      fill: "group",
      tip: true,
      title: d => currentViewMode === "Counts" 
        ? `${d.group}\nCount: ${d.count.toLocaleString()}\nTotal: ${d.total.toLocaleString()}`
        : currentViewMode === "Population Prevalence %"
        ? `${d.group}\nPopulation Prevalence: ${d.prevalence.toFixed(1)}%\nCount: ${d.count.toLocaleString()} / ${d.total.toLocaleString()}`
        : `${d.group}\nWithin-Group Prevalence: ${d.withinGroupPrevalence.toFixed(1)}%\nCount: ${d.count.toLocaleString()} / ${d.groupTotal.toLocaleString()} total ${d.group.toLowerCase()} patients`
    }),
    Plot.text(chartData, {
      x: "group",
      y: currentViewMode === "Counts" ? "count" : 
         currentViewMode === "Population Prevalence %" ? "prevalence" : "withinGroupPrevalence",
      text: d => currentViewMode === "Counts" 
        ? d.count.toLocaleString()
        : currentViewMode === "Population Prevalence %"
        ? `${d.prevalence.toFixed(1)}%`
        : `${d.withinGroupPrevalence.toFixed(1)}%`,
      dy: -10,
      fill: "black",
      fontSize: 14,
      fontWeight: "bold"
    })
  ]
})
))
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">OHDSI-Stroke</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./">Home</a></li>
    <li class="observablehq-link"><a href="./methodology">Methodology</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./cohort-explorer">Interactive Cohort Explorer</a></li>
    <li class="observablehq-link"><a href="./statistics-report">Statistics Report</a></li>
    <li class="observablehq-link"><a href="./predictive-modeling">Predictive Modeling Report</a></li>
    <li class="observablehq-link"><a href="./explanatory-modeling">Explanatory Modeling Report</a></li>
    <li class="observablehq-link"><a href="./visualizations">Visualizations</a></li>
    <li class="observablehq-link"><a href="./key-takeaways">Key Takeaways</a></li>
    <li class="observablehq-link"><a href="./conclusions">Conclusions</a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<h1 id="interactive-cohort-explorer" tabindex="-1"><a class="observablehq-header-anchor" href="#interactive-cohort-explorer">Interactive Cohort Explorer</a></h1>
<h2 id="aphasia-distribution-by-selected-conditions" tabindex="-1"><a class="observablehq-header-anchor" href="#aphasia-distribution-by-selected-conditions">Aphasia Distribution by Selected Conditions</a></h2>
<p>This interactive graph allows you to explore the post-stroke aphasia patient cohort by selecting various health conditions and medication patterns. The graph will automatically update and show the aphasia distribution within your filtered group (multiple selections are cumulative as patients will match every condition checked). Toggle between raw counts, population prevalence, or within-group prevalence.</p>
<div class="observablehq observablehq--block"><!--:1d803bd4:--></div>
<div class="observablehq observablehq--block"><!--:4ce638d1:--></div>
<hr>
<p><strong>Total Patients:</strong> <observablehq-loading></observablehq-loading><!--:8edf6297:--> | <strong>With Aphasia:</strong> <observablehq-loading></observablehq-loading><!--:b67d9ad2:--> | <strong>Without Aphasia:</strong> <observablehq-loading></observablehq-loading><!--:1fa81da3:--></p>
<hr>
<div class="observablehq observablehq--block"><!--:86c65c59:--></div>
<div class="observablehq observablehq--block"><!--:9a93ab0d:--></div>
<div class="observablehq observablehq--block"><!--:be7a6c50:--></div>
<div class="observablehq observablehq--block"><!--:098973fe:--></div>
<p><strong>Filtered Cohort Size:</strong> <observablehq-loading></observablehq-loading><!--:19b75ab1:--> patients<br>
<strong>Filtered by:</strong> <observablehq-loading></observablehq-loading><!--:0b0ebcb5:--></p>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:82ec1f34:--></div>
<hr>
<ul>
<li>
<p>Polypharmacy (All Meds) refers to people who have been on 5+ meds for 30+ days concurrently within the observation period. Polypharmacy (PIMs) refers to the same parameters except only within the medications considered PIMs</p>
</li>
<li>
<p>Risk conditions consist of those who have been taking a PIM within the observation period, but without any corresponding diagnoses for the mental health conditions associated to that medication. For more information on this, refer to the <a href="./methodology#high-risk-methodology">Methodology</a> section</p>
</li>
<li>
<p>This graph is also modularizable in that as long as you replace the <code>high_risk_cohort_no_dementia.csv</code> with a new one (can be created automatically in our repository with the advised makefile commands), changes will automatically be applied.</p>
</li>
</ul>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./methodology"><span>Methodology</span></a><a rel="next" href="./statistics-report"><span>Statistics Report</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-12-04T02:20:29">Dec 4, 2025</a>.</div>
</footer>
</div>
</body>
</html>
